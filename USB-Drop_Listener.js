#!/usr/bin/env node

/*
USB Information Listener to be used with the matching Call Back
This program listens for call backs and records input to a log file
Written by Victor Wieczorek, July 2015
*/

var net = require('net');
var fs = require('fs');

// Set up listener
var onConnection = function (socket) {
  socket.on('data', function (data) {
    // Receive and decode the base64 string
    var buf = new Buffer(data.toString('ascii'), 'base64').toString('ascii').replace(/\s\s+/g, "");
    // Write input to log file
    fs.appendFile("/root/usb.log", buf + "\n\r", function(err) {
      if(err) {
        return console.log(err);
      }
    });
  socket.pipe(process.stdout);
  });
};
// Start listener on port 5880 -- make sure port matches what is in the callback file
net.createServer(onConnection).listen(5880);